name palette_changer
type none
shadow 0

anim spawn
    
    delay 1
    frame data/chars/misc/blank.png

anim idle
@script
int pal = getglobalvar("pal");
int maxpal = getglobalvar("maxpal");
if(pal==NULL() || maxpal==NULL())
{
    killentity(getlocalvar("self"));
}
else
{
    int shadowdx = getglobalvar("sdx");
    int shadowdz = getglobalvar("sdz");
    changepalette(pal);
    if(pal<maxpal)
    {
        pal++;
        setglobalvar("pal", pal);
        if(shadowdx && shadowdz)
        {
            changelight(openborvariant("lightx")+shadowdx, 
                        openborvariant("lightz")+shadowdz);
        }
    }
    else
    {
        setglobalvar("pal", NULL());
        setglobalvar("maxpal", NULL());
        setglobalvar("sdx", NULL());
        setglobalvar("sdz", NULL());
    }
}
@end_script
    loop 1
    delay 20
    frame data/chars/misc/blank.png
