# door

name	door
type	none
shadow	0

globalmap 1

anim spawn
loop 1
delay 10
@script
int ind = getglobalvar("doorindex");
void self = getlocalvar("self");
if(frame==1)
{
    if(ind!=NULL())
    {
        if(ind>0)
        {
            int t = getglobalvar("doortimer"+ind);
            if(t>0)
            {
                setglobalvar("doortimer"+ind, --t);
            }
            else
            {
                changeentityproperty(self, "animation", A_IDLE);
            }
        }
        else
        {
            killentity(getglobalvar("dummy"));
            setglobalvar("dummy", NULL());
            setglobalvar("doorindex", NULL());
            killentity(self);
            
        }
    }
}
else
{
    changeentityproperty(self, "base", getentityproperty(self, "a"));
}
@end_script
    offset	0 0
    frame data/chars/misc/empty.gif
    frame data/chars/misc/empty.gif


anim idle
	loop	0
	delay	20
    offset	50 105
    sound data/sounds/door.wav
    frame data/bgs/town/door/1.gif
    frame data/bgs/town/door/2.gif
    frame data/bgs/town/door/1.gif
@script
void self = getlocalvar("self");
if(frame==1)
{
    int index = getglobalvar("doorindex");
    clearspawnentry();
    setspawnentry("name", getglobalvar("doorspawn"+index));
    setspawnentry("alias", getglobalvar("dooralias"+index));
    setspawnentry("map", getglobalvar("doormap"+index));
    setspawnentry("coords", getentityproperty(self, "x")-openborvariant("xpos"), getentityproperty(self, "z")+22, getentityproperty(self, "a"));
    spawn();
    setglobalvar("doortimer"+index, NULL());
    setglobalvar("doorindex", --index);
}
else if(frame==3)
{
    changeentityproperty(self, "animation", A_SPAWN);
}
@end_script
    frame data/chars/misc/empty.gif
