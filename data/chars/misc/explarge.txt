name explarge
type item
candamage enemy
nomove 1

globalmap 1

anim spawn
@script
void self = getlocalvar("self");
if(getentityproperty(self, "base") < 0)
{
    killentity(self);
}
if(frame==2 || frame==5)
{
    int c = getglobalvar("largeexp_count");
    int z1 = openborvariant("player_min_z");
    int z2 = openborvariant("player_max_z");
    int sx; int sz;
    if(c!=NULL())
    {
        clearspawnentry();
        setspawnentry("name", "explarge");
        do
        {
            sx = rand()%480;
            sz = rand()%(z2-z1);
            if(sx<0){ sx = -sx;}
            if(sz<0){ sz = -sz;}
        }while(checkhole(sx+openborvariant("xpos"),sz+z1)&&!checkwall(sx+openborvariant("xpos"),sz+z1));
        setspawnentry("coords", sx, sz+z1, 0);
        void e = spawn();
        if(e!=NULL())
        {
            changeentityproperty(e, "owner", getentityproperty(self, "owner"));
            c--;
            if(c<=0)
            {
                setglobalvar("largeexp_count", NULL());
            }
            else
            {
                setglobalvar("largeexp_count", c);
            }
        }
    }
}
else if(frame==6)
{
    killentity(self);
}
@end_script
    
    delay 8
    offset 64 112
    quakeframe 1 4 3
    frame data/chars/misc/empty.gif
    sound data/sounds/rumble.wav
    frame data/chars/misc/explarge/1.gif
    
    hitflash none
    attack5 -1 1 0 0 1
    dropv  5 2 0
    damageonlanding 16 1
    attackz 100
    frame data/chars/misc/explarge/2.gif
    frame data/chars/misc/explarge/3.gif
    frame data/chars/misc/explarge/4.gif
    attack5 0
    
    frame data/chars/misc/explarge/5.gif
    frame data/chars/misc/empty.gif

anim idle
    
    delay 8
    offset 64 112
    quakeframe 0 4 3
    
    frame data/chars/misc/explarge/1.gif
    
    hitflash none
    attack5 0 0 128 112 8 1 1 1
    dropv  5 2 0
    damageonlanding 8 1
    attackz 100
    frame data/chars/misc/explarge/2.gif
    frame data/chars/misc/explarge/3.gif
    frame data/chars/misc/explarge/4.gif
    attack5 0
    frame data/chars/misc/explarge/5.gif
@cmd killentity getlocalvar("self")
    frame data/chars/misc/empty.gif


